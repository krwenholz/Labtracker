<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    <link rel="stylesheet" href="bootstrap.css" type="text/css" media="screen" title="no title" charset="utf-8">
       <style type="text/css">
      body {
        padding-top: 60px;
      }
    </style>
    
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>

<script type="text/javascript">
jQuery.noConflict();
</script>

<script type="text/javascript" src="js/highcharts.js"></script>
<script type="text/javascript" src="js/modules/exporting.js"></script>
<script type="text/javascript" src="js/themes/myTheme.js"></script>
<script type="text/javascript" src="sparkline.min.js"></script>

<script type="text/javascript">
<!-- A SIMPLE SPACE WILL ENABLE 'WORD WRAPPING' IN LABELS-->
var activityChart;
var activityOptions;

function updateActivity(activityData, activityLabels){
        activityChart.xAxis[0].setCategories(activityLabels, 
            false);
        activityChart.series[0].setData(activityData);
};
function loadActivity(activityData, activityLabels) {
		activityOptions = { chart: {
 //DO NOT CHANGE THIS VARIABLE NAME. IT IS A VARIABLE.
			renderTo: 'activityContainer',
			defaultSeriesType: 'bar'
		},
		title: {
			text: 'Recent Activity'
		},
		xAxis: {
			categories: activityLabels
		},
		yAxis: {
			min: 0,
			title: {
				text: 'Frequency',
				align: 'high'
			}
		},
		tooltip: {
			formatter: function() {
				return ''+this.x +': '+ this.y;
			}
		},
		plotOptions: {
			bar: {
				dataLabels: {
					enabled: true
				}
			}
		},
		legend: {
			layout: 'vertical',
			align: 'right',
			verticalAlign: 'top',
			x: -100,
			y: 100,
			floating: true,
			borderWidth: 1,
			backgroundColor: Highcharts.theme.legendBackgroundColor || '#FFFFFF',
			shadow: true
		},
		credits: {
			enabled: false
		},
	        series: [{
			data: activityData
		}]
	}

        activityChart = new Highcharts.Chart(activityOptions);
	
	
};

var compilesChart;
var compilesOptions;

function updateCompiles(compilesData, compilesLabels){
        compilesChart.xAxis[0].setCategories(compilesLabels, false);
        compilesChart.series[0].setData(compilesData);
};
function loadCompiles(compilesData, compilesLabels) {
	compilesOptions = {chart: {//DO NOT CHANGE THIS VARIABLE NAME. IT IS A VARIABLE.
			renderTo: 'compilesContainer',
			defaultSeriesType: 'bar'
		},
		title: {
			text: 'Recent Compiles'
		},
		xAxis: {
			categories: compilesLabels
		},
		yAxis: {
			min: 0,
			title: {
				text: 'Frequency',
				align: 'high'
			}
		},
		tooltip: {
			formatter: function() {
				return ''+ this.x +': '+ this.y;
			}
		},
		plotOptions: {
			bar: {
				dataLabels: {
					enabled: true
				}
			}
		},
		legend: {
			layout: 'vertical',
			align: 'right',
			verticalAlign: 'top',
			x: -100,
			y: 100,
			floating: true,
			borderWidth: 1,
			backgroundColor: Highcharts.theme.legendBackgroundColor || '#FFFFFF',
			shadow: true
		},
		credits: {
			enabled: false
		},
	        series: [{
			data: compilesData
		}]
	}		

        compilesChart = new Highcharts.Chart(compilesOptions);	
};

/**
 * Request data from the server, add it to the graphs and set a timeout to request again
 */
function updateChartData(){
    /* call the php that has the php array which is json_encoded */
    jQuery.getJSON('updateData.php', function(data) {
        /* data will hold the php arrays as a javascript object */
        fixInts(data);
        fixStrings(data);
        hideData(data);
        updateActivity(data[0], data[1]);
        updateCompiles(data[2], data[3]);
        var newVal = 0;
        for(i in data[3]){
            newVal = newVal + i;
        }
        compileErrorsSpark(newVal);
    });
    
};

/**
* Corrects the data type of an array of integers
*/
function fixInts(datas){
    //FIX INTEGERS
    data = datas[0];
    data = data.substring(1, data.length);
    data = data.substring(0, data.length - 1);
    data = data.split(",");
    goodData = [];
    for(i=0; i<data.length && i<5; i=i+1){
	goodData[i] = parseInt(data[i]);
    }
    datas[0] = goodData;
    data = datas[2];
    data = data.substring(1, data.length);
    data = data.substring(0, data.length - 1);
    data = data.split(",");
    goodData = [];
    for(i=0; i<data.length; i=i+1){
	goodData[i] = parseInt(data[i]);
    }
    datas[2] = goodData;
}

/**
* Corrects the data type of an array of strings.
*/
function fixStrings(datas){
    //FIX STRINGS
    data = datas[1];
    data = data.substring(2, data.length);
    data = data.substring(0, data.length - 2);
    data = data.split("', '");
    goodData = [];
    for(i=0; i<data.length && i<5; i=i+1){
        goodData[i] = data[i];
    }
    datas[1] = goodData;
    data = datas[3];
    data = data.substring(2, data.length);
    data = data.substring(0, data.length - 2);
    data = data.split("', '");
    goodData = [];
    for(i=0; i<data.length && i<5; i=i+1){
        goodData[i] = data[i];
    }
    datas[3] = goodData;
};

/**
 * Removes entries with a frequency of only one.
**/
function hideData(datas){
    for(i=0; i<(datas[0]).length; i=i+1){
        if(datas[0][i]==1){
            datas[0].splice(i,1);
	    datas[1].splice(i,1);
	}
    }
    for(i=0; i<(datas[2]).length; i=i+1){
        if(datas[2][i]==1){
            datas[2].splice(i,1);
	    datas[3].splice(i,1);
	}
    }
};

/**
 * Draws a sparkline with the new value at the end.
**/
var compSparkValues=[0,0,0,0,0,0,0,0,0,0];
var skip = 0;
function compileErrorsSpark(newVal){
        if(skip == 5){
	    skip = 0;
	    return;
        };
	skip = skip+1;
        compSparkValues.shift();
	compSparkValues.push(newVal);
        /* Sparklines can also take their values from the first argument 
        passed to the sparkline() function */
        jQuery('#compErrorsSpark').sparkline(compSparkValues, {lineColor: 'blue', width: '100px'});

    };
</script>
    <title>LabTracker-Live</title>   

</head>
<body>
    
    <div class="topbar">
      <div class="topbar-inner">
        <div class="container-fluid">
          <a class="brand" href="#">LabTracker Live</a>

          <ul class="nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="liveClientView.html">Live View</a></li>
          </ul>

        </div>
      </div>
    </div>

      <!--black = 171717 23,23,23
      dark blue = 0C5A81 12,90,129
      light grey = D7E0E5 215,224,229
      white = FFFFFF 255,255,255
      orange = D84704 216,71,4
      -->
</div>
</div>
<div class="content">
<div class="row">
<div class="span3 offset2">
  <h3 id="sessionName"></h3>
</div>
<div class="span5 offset2">
  <h3>Compile Errors <div id="compErrorsSpark" style="width:100px"></div></h3>
</div>
<div class="span3 offset2">
  
</div>
</div>
<div class="row">
  <div class="span8" style="margin-right=10px;">
    <div id="activityContainer" class="highcharts-container" style="height:450px; margin: 0 2em; clear:both; min-width: 600px;"> </div>
  </div>
  <div class="span8 offset3">
    <div id="compilesContainer" class="highcharts-container" style="height:450px; margin: 0 2em; clear:both; min-width: 600px"> </div>
  </div>
</div>
</div>
<script type="text/javascript">
//loadCompiles([], []);
//loadActivity([], []);
//var i=0;
//function incI(){
//i = i+1;
//datas=["[1, "+i+", 3]", "['ONE DATA', 'jack', 'jill']", "[6, 7, "+i+"]", 
//    "['abbatu:l?+-huhasuh', 'Hy my name is kyle Wen!tuhsau09',"+
//     " '34753498274874593472']"];
//fixInts(datas);
//fixStrings(datas);
//hideData(datas);
//updateCompiles(datas[0], datas[1]);
//updateActivity(datas[2], datas[3]);
//}
//jQuery(window).ready(function(){
//incI();
//});
//setInterval(incI, 5000);
//THE ACTUAL CODE
loadActivity([],[]);
loadCompiles([],[]);
setInterval(updateChartData, 5000);
</script>
</body>
</html>



<!--
var i = 0;
function spark(){
i= i+3;
if(i == 30){
i = 0;
} compileErrorsSpark(i);
};
setInterval(spark, 1000);
//-->
<!--
loadCompiles([0], ['boo']);
drawCompiles();
loadActivity([0], ['boo']);
drawActivity();
var i=0;
function incI(){
i = i+1;
updateCompiles([i, 3], ['jack', 'jill']);
updateActivity([6, 7, i], ['abbatu:l?+-huhasuh', 'Hy my name is kyle Wen!tuhsau09', '34753498274874593472']);
}
jQuery(window).ready(function(){
incI();
});
setInterval(incI, 5000);-->
